\subsection{Nix grammar}
\label{sec:nix-grammar}

The grammar of nix is given at Figures~\pref{grammar::nix}
and~\pref{grammar::types}. It consists\todo{Remove as soon as the grammar is
extended} of a simple lambda calculus with lists (and type annotations).

\begin{figure}
  \input{grammar/nix}
  \caption{\label{grammar::nix}The nix grammar for expressions}
\end{figure}

\begin{figure}
  \input{grammar/types}
  \caption{\label{grammar::types}The nix and nix-light grammar for types}
\end{figure}

\subsection{nix-light}
\label{sec:nix-light-grammar}

The grammar of nix-light is based of the grammar of nix and brings several
modifications:
\begin{itemize}
  \item The main difference concerns records, whose representation is simplified as
    much as possible:

    \begin{itemize}
      \item Litteral records are always atomic (\emph{ie} only have one field). An
        \emph{orthogonal merge} operator ($\orthplus$) allows building complex
        records~\footnote{We still often write \{ $s_1$ = $y_1$; $\cdots{}$;
        $s_n$ = $y_n$ \} as a shorthand for \{ $s_1$ = $y_1$; \} $\orthplus
        \cdots{} \orthplus$ \{ $s_n$ = $y_n$; \}},

      \item The syntax in nix for a recursive definition of records (\texttt{\{ x.y
        = 1; x.z = 2; \}}) doesn't exist anymore,

      \item The labels can only be nix expressions (so litteral labels must be
        written as constant strings).
    \end{itemize}

  \item Another huge change is the removal of the \emph{if} construct which is
    replaced by a more general \emph{typecase} which is easier to reason on.

  \item Let bindings are not recursive by default anymore; a special \emph{let
    rec} construct is introduced equivalent to the recursive \emph{let} of Nix.

  \item Default values in patterns may only be constants. This makes typing of
    patterns easier, without impact on the expressivity.

  \item The last notable change is that the opaque list construct of nix is
    replaced by the classical \texttt{nil} and \texttt{cons}.
    This avoids having over-complicated typing and evaluation rules for lists.

    For consistency, a pattern for lists has also been added.
\end{itemize}

The grammar of nix-light is given in the
figures~\pref{grammar::expressions},~\pref{grammar::values}
and~\pref{grammar::types}.

\begin{figure}
  \input{grammar/expressions}
  \caption{\label{grammar::expressions}The nix-light grammar for expressions}
\end{figure}

\begin{figure}
  \input{grammar/values}
  \caption{\label{grammar::values}The nix-light grammar for values}
\end{figure}
