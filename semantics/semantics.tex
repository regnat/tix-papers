To make the reduction rules simpler and easier to read, we define an
``annotation erasing'' operator $\var(r)$ for variable patterns:
\[
  \var(x) = \var(x:\τ) = x
\]

The reduction rules are presented in figure~\pref{fig:semantics:nix-light} and
the evaluation contexts in
figure~\pref{fig:semantics:nix-light:reduction-contexts}.

The rules for the pattern-matching are in
figure~\pref{fig:semantics:nix-light:patterns}

\begin{figure}
  \begin{align*}
    \dstepa{(\λ r .e_1) e_2}{\substp{\var(r)}{e_2}{e_1}}{}
    \dstepa{(\λ p.e_1) v} {\substp{p}{v}{e_1}}{\text{if } p \neq r}
    \dstepa{(x := v \in \τ~? \eone: e_2)}{\subst{x}{v}{\eone}}{\text{if } \vdash v : \τ}
    \dstepa{(x := v \in \τ~? \eone: e_2)}{\subst{x}{v}{e_2}}{\text{if } \vdash v : \lnot\τ}
    \dstepa{\text{let } r = e; \text{ in } e'}{%
      \subst{\var(r)}{\text{\text{let } r = e; \text{ in } e}}{e'}
    }{}
    \dstepa{\text{let } r_1 = \eone; \cdots{}; r_n = \en; \text{ in } e}{%
      (\text{let } y = \{ x_1 = \eone; \cdots; x_n = \en{} \}; \text{ in } e) [
          \assign{\var(r_1)}{y.x_1}; \cdots; \assign{\var(r_n)}{y.x_n}
          ]
    }{}
      &\text{Where } x_1, \cdots, x_n \text{ don't appear free in } e_1, \cdots, e_n \text{ or } e
  \end{align*}
  \caption{Nix-light reduction rules\label{fig:semantics:nix-light}}
\end{figure}

\begin{figure}
  \begin{align*}
    \eqdefa{\sfrac{r}{e}}{\sfrac{\var(r)}{e}}{}
    \eqdefa{\sfrac{q@x}{e}}{\sfrac{x}{e}; \sfrac{q}{e}}{}
    \eqdefa{\sfrac{q:t}{e}}{\sfrac{q}{e}}{}
    \eqdefa{%
      \sfrac{\text{Cons}(e_1, e_2)}{\text{Cons}(r_1, r_2)}%
    }{\sfrac{r_1}{e_1}; \sfrac{r_2}{e_2}}{}
    \eqdefa{\sfrac{\text{Nil}}{\text{Nil}}}{\varnothing}{}
  \end{align*}

  \caption{Semantic of the pattern-matching in nix-light\label{fig:semantics:nix-light:patterns}}
\end{figure}

\begin{figure}
  \begin{grammar}
    \bfseries
    <E> ::= [] \| \meta{E} \meta{e}
    \alt \meta{E.a} \| \meta{E.a} or \meta{e} \| \meta{v.F} \| \meta{v.F} or \meta{e}
    \alt \{ $v$ = $e$; $\cdots{}$; $v$ = $e$; $E$ = $e$; $\cdots{}$; $e$ = $e$ \}
    \alt with $E$; $e$ | if $E$ then $e$ else $e$

    <F> ::= $E$.$a$ \| $v$.\meta{F}
  \end{grammar}
  \caption{Reduction contexts for nix-light\label{fig:semantics:nix-light:reduction-contexts}}
\end{figure}
